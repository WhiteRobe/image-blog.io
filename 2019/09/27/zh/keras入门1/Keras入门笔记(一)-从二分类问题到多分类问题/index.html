
<!DOCTYPE html>
<html lang="zh" class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title> - WhiteRobe&#39;s Blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.0/katex.min.css" rel="stylesheet">
    <meta name="keywords" content="WhiteRobe, Blog,"> 
    <meta name="description" content="着眼实例，从最简单的开始；你觉得再简单不过的东西，或许在别人眼里那就是悬崖。而我，愿作那攀岩绳。,
 


Keras入门笔记(一)-从二分类问题到多分类问题html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --t,"> 
    <meta name="author" content="WhiteRobe"> 
    <link rel="alternative" href="atom.xml" title="WhiteRobe&#39;s Blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/fira_code.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
        <!--站内搜索API-->
        <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@7.3.1/themes/algolia-min.css" integrity="sha256-HB49n/BZjuqiCtQQf49OdZn63XuKFaxcIHWf0HNKte8=" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@3.4.0/dist/instantsearch.production.min.js" integrity="sha256-pM0n88cBFRHpSn0N26ETsQdwpA7WAXJDvkHeCLh3ujI=" crossorigin="anonymous"></script>
    
    <!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
          // No more ads!
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script> -->
</head>
</html>
<body class="loading">
    <span id="config-title" style="display:none">WhiteRobe&#39;s Blog</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block; display: block;position: fixed; top: 0px;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" data-url="https://blog.whiterobe.top"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle"></h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div style="font-size: 1rem;margin-right: -10px">
          分享此文：
        </div>
        <div>
          <div class="share">
              <a title="获取文章地址二维码" class="icon-scan" href="javascript:;"></a>
          </div>
          <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section" style="margin-top: 50px">
        <div class="article">
    <div class='main'>
        <h1 class="title"></h1>
        <div class="stuff">
            <span>九月 27, 2019</span>
            <span id="busuanzi_container_page_pv" class="busuanzi_page" style="display:none">本文总阅读量<div id="busuanzi_value_page_pv" style="display: inline;">1</div>次</span>
            

        </div>
        <div class="low-resolution-warn-info">当前设备屏幕尺寸过小，推荐使用PC模式浏览。</div>
        <div class="content markdown">
            <!doctype html>
<html> 
<head><meta name="generator" content="Hexo 3.9.0">
<meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1">
<title>Keras入门笔记(一)-从二分类问题到多分类问题</title><style type="text/css">html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


.cm-s-inner { padding: 0.5rem 0.2rem; border-radius: 0.25rem; border: 1px solid var(--accent-color)  !important; }
.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters { border: none; background-color: rgb(40, 42, 54) !important; color: rgb(248, 248, 242) !important; }
.cm-s-inner .CodeMirror-gutters { width: 5ch; color: rgb(109, 138, 136); }
.cm-s-inner .CodeMirror-cursor { border-left: thin solid rgb(248, 248, 242) !important; }
.cm-s-inner .CodeMirror-linenumber { color: rgb(109, 138, 136); width: 4ch !important; }
.cm-s-inner span.cm-comment { color: rgb(98, 114, 164); }
.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 { color: rgb(80, 250, 123); }
.cm-s-inner span.cm-number { color: rgb(189, 147, 249); }
.cm-s-inner span.cm-variable, .cm-s-inner span.cm-variable-2 { color: white; }
.cm-s-inner span.cm-def { color: white; }
.cm-s-inner span.cm-operator { color: rgb(255, 121, 198); }
.cm-s-inner span.cm-keyword { color: rgb(223, 114, 13); }
.cm-s-inner span.cm-atom { color: rgb(189, 147, 249); }
.cm-s-inner span.cm-meta { color: rgb(248, 248, 242); }
.cm-s-inner span.cm-tag { color: rgb(255, 121, 198); }
.cm-s-inner span.cm-attribute { color: rgb(199, 34, 23); }
.cm-s-inner span.cm-qualifier { color: rgb(80, 250, 123); }
.cm-s-inner span.cm-property { color: rgb(102, 217, 239); }
.cm-s-inner span.cm-builtin { color: rgb(102, 217, 239); }
.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type { color: rgb(255, 184, 108); }
.md-fences.md-focus .cm-s-inner .CodeMirror-activeline-background { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }
.cm-s-inner .CodeMirror-selected, .cm-s-inner .CodeMirror-selectedtext { color: inherit; text-shadow: none; background: rgb(59, 66, 84) !important; }
#fences-auto-suggest .active { background: rgb(60, 60, 60); }
#write .code-tooltip { bottom: initial; top: calc(100% - 1px); background: rgb(40, 42, 54); border-width: 0px 1px 1px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-right-color: rgb(60, 60, 60); border-bottom-color: rgb(60, 60, 60); border-left-color: rgb(60, 60, 60); border-image: initial; border-top-style: initial; border-top-color: initial; }
.auto-suggest-container { border-color: rgb(91, 91, 91); }
.auto-suggest-container .autoComplt-hint.active { background: rgb(43, 43, 43); color: rgb(255, 255, 255); }
:root { --bg-color: #1e2022; --text-color: #ddd; --md-char-color: #5b5b5b; --meta-content-color: #757575; --table-border-color: #5b5b5b; --primary-color: #428bca; --primary-btn-border-color: #285e8e; --primary-btn-text-color: #ddd; --window-border: 1px solid #16161a; --active-file-bg-color: #16161a; --active-file-text-color: inherit; --active-file-border-color: #757575; --active-search-item-bg-color: #212121; --side-bar-bg-color: #2b2b2b; --item-hover-bg-color: #1e2022; --item-hover-text-color: #fff; --search-select-text-color: #ddd; --search-select-bg-color: #428bca90; --rawblock-edit-panel-bd: #3c3c3c; --monospace: "Cousine", "Consolas", monospace; }
html, body { font-family: "Avenir Next LT Pro", Lato, sans-serif; }
body { font-size: 1em; }
h1, h2, h3, h4, h5, h6 { font-family: Adelle, "Times New Roman", serif; }
p { margin: 0.5rem 0px; }
a { color: rgb(107, 202, 251); }
del { color: rgb(91, 91, 91); }
mark { padding: 2px 1px; background: rgba(25, 97, 134, 0.816); color: inherit; }
blockquote { position: relative; margin: 1rem 0px 1rem 2rem; font-family: Adelle, "Times New Roman", serif; }
blockquote::before { content: ""; position: absolute; left: -2rem; height: 100%; width: 0.25rem; background: rgb(66, 139, 202); }
code, .md-fences, tt { font-family: "Fira Code", Cousine, Consolas, monospace; font-size: 1rem; }
code { font-size: 0.9em; border: 1px solid rgb(60, 60, 60); border-radius: 0.25rem; padding: 0px 0.125rem; background: transparent; }
hr { border-color: rgb(91, 91, 91); }
table { border: 1px solid rgb(91, 91, 91); margin: 1rem 0px; }
table tr:nth-child(2n) { background: rgb(60, 60, 60); }
thead { background: rgb(77, 77, 77); }
td, th { padding: 0.35rem 0.7rem; border: 1px solid rgb(91, 91, 91); }
#write { position: static; width: 90%; max-width: 1260px; line-height: 1.5; transform: none; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: auto; }
#write h1::before, #write h2::before, #write h3::before, #write h4::before, #write h5::before, #write h6::before { position: absolute; right: calc(100% + 10px); bottom: 0px; color: rgb(91, 91, 91); font-size: 1rem; font-weight: bold; border: 0px; border-radius: 0px; left: auto; float: none; padding: 0px; vertical-align: baseline; line-height: 20px; }
#write h1 { font-size: 1.8rem; margin: 1rem 0px; }
#write h1::before { content: "H1"; bottom: 0.45rem; }
#write h2 { font-size: 1.4rem; margin: 0.7rem 0px; }
#write h2::before { content: "H2"; bottom: 0.2rem; }
#write h3 { font-size: 1.2rem; margin: 0.5rem 0px; }
#write h3::before { content: "H3"; bottom: 0.18rem; }
#write h4 { font-size: 1.1rem; margin: 0.2rem 0px; }
#write h4::before { content: "H4"; bottom: 0.15rem; }
#write h5, #write h6 { font-size: 1rem; margin: 0px; }
#write h5::before, #write h6::before { bottom: 0.1rem; }
#write h5::before { content: "H5"; }
#write h6::before { content: "H6"; }
#write ol, #write ul { padding-left: 2rem; margin: 0.5rem 0px; }
#write ol > li, #write ul > li { color: rgb(66, 139, 202); }
#write ol > li > *, #write ul > li > * { color: rgb(221, 221, 221); }
#write ol > li > :not(ol):not(ul), #write ul > li > :not(ol):not(ul) { padding-left: 0.25rem; }
#write ul { list-style-type: disc; }
#write .md-task-list-item > input { -webkit-appearance: initial; display: block; position: absolute; border: 1px solid rgb(91, 91, 91); border-radius: 0.25rem; margin-top: 0.1rem; margin-left: -1.8rem; height: 1.2rem; width: 1.2rem; transition: background 0.3s ease 0s; }
#write .md-task-list-item > input:focus { outline: none; box-shadow: none; }
#write .md-task-list-item > input:hover { background: rgb(60, 60, 60); }
#write .md-task-list-item > input[checked]::before { content: ""; position: absolute; top: 20%; left: 50%; height: 60%; width: 2px; transform: rotate(40deg); background: rgb(221, 221, 221); }
#write .md-task-list-item > input[checked]::after { content: ""; position: absolute; top: 46%; left: 25%; height: 30%; width: 2px; transform: rotate(-40deg); background: rgb(221, 221, 221); }
#write .md-task-list-item > p { transition: color 0.3s ease 0s; }
#write .md-task-list-item.task-list-done > p { color: rgb(91, 91, 91); text-decoration: line-through; }
#write .md-meta-block { background-color: transparent; border-bottom: 1px solid rgb(91, 91, 91); padding-bottom: 1rem; opacity: 0.8; }
#write .md-table-edit { border-top: 1px solid rgb(91, 91, 91); padding: 3px 0px; margin-top: -29px !important; }
#write .md-grid-board a.md-active, #write .md-grid-board a:hover { background: rgb(66, 139, 202); color: rgb(91, 91, 91); }
#write .md-grid-board tr[row="1"] a.md-active, #write .md-grid-board tr[row="1"] a:hover { background: rgb(40, 94, 142); color: rgb(91, 91, 91); }
#write .btn-group .btn + .btn { margin-left: 0px; }
#write .btn-default.active, #write .btn-default.focus, #write .btn-default:active, #write .btn-default:focus, #write .btn-default:hover, .open > #write .btn-default.dropdown-toggle { background: transparent; color: inherit; }
#write .typora-table-drag-area::after { content: ""; position: absolute; border: 2px solid rgb(221, 221, 221); opacity: 0; transition: opacity 0.4s ease 0s; }
#typora-table-row-tracker #write .typora-table-drag-area::after, #typora-table-col-tracker #write .typora-table-drag-area::after { opacity: 1; }
#typora-table-row-tracker #write .typora-table-drag-area::after { top: 0px; left: 50%; transform: translateX(-50%); width: 0px; height: 100%; }
#typora-table-col-tracker #write .typora-table-drag-area::after { top: 50%; left: 0px; transform: translateY(-50%); width: 100%; height: 0px; }
#write .md-toc-tooltip { z-index: 10; }
#write .md-toc-item { font-size: 1.1rem; color: var(--primary-btn-border-color); }
#write .md-toc-h1 { font-family: Adelle, "Times New Roman", serif; font-size: 1.3rem; }
#write .md-toc-h2 { font-size: 1.2rem; }
#write .md-footnote { font-family: Adelle, "Times New Roman", serif; font-size: 0.8em; border: 1px solid rgb(60, 60, 60); padding: 0px 4px; background: rgb(17, 17, 17); color: rgb(221, 221, 221); }
#write .md-def-split { min-width: 1ch; }
#write .md-def-name::before, #write .md-def-name::after { color: rgb(117, 117, 117); }
#write .md-image > .md-meta { color: rgb(117, 117, 117); }
#write .md-rawblock-tooltip { top: -1.5rem; height: 1.5rem; padding: 0.25rem; }
#write .md-search-hit { background: rgba(66, 139, 202, 0.25); border-radius: 0.125rem; }
#write .md-search-select { background: rgba(66, 139, 202, 0.565); border: 1px solid rgba(146, 146, 146, 0.56); padding: 0px 1px; }
#typora-quick-open { top: 32px; width: 40%; min-width: 420px; transform: translateX(-50%); margin-left: 0px; }
.mac-seamless-mode #typora-quick-open { top: 50px; }
#typora-quick-open #typora-quick-open-input input { border-color: rgb(66, 139, 202); }
#typora-quick-open .ty-quick-open-category-title { height: auto; padding-top: 4px; padding-left: 12px; }
#typora-quick-open .typora-quick-open-item { display: flex; flex-direction: column; justify-content: center; cursor: pointer; }
#typora-quick-open .typora-quick-open-item:not(.active):hover { background: rgb(33, 33, 33); }
#typora-quick-open .typora-quick-open-item-path { margin-top: -2px; }
.ty-tooltip { background: rgb(43, 43, 43); color: rgb(221, 221, 221); border-color: rgba(0, 0, 0, 0.25); }
.code-tooltip.md-f-tooltip, .code-tooltip.md-f-tooltip .md-arrow::after { background: rgb(17, 17, 17) !important; color: rgb(221, 221, 221) !important; }
.code-tooltip.md-f-tooltip a { color: rgb(107, 202, 251); }
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container), .on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) *, .on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) ol, .on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) ul { color: rgb(91, 91, 91) !important; }
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) img, .on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) .md-footnote, .on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) .md-emoji { opacity: 0.5; }
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) mark { background: rgb(60, 60, 60); }
.on-focus-mode blockquote .md-end-block:not(.md-focus):not(.md-focus-container)::before { opacity: 0.5; }
.on-focus-mode li:not(.md-focus-container)::before { opacity: 0.5; }
#typora-sidebar { border-right: 1px solid rgb(25, 25, 28); }
#typora-sidebar .sidebar-tabs { font-family: Adelle, "Times New Roman", serif; border-bottom: 1px solid rgb(25, 25, 28); }
#typora-sidebar .file-list-item-file-name { font-family: Adelle, "Times New Roman", serif; font-size: 1.2em; }
#typora-sidebar #file-library-search-input { background: rgb(43, 43, 43); }
#typora-sidebar #file-library-search .file-list-item-file-name { font-size: 1.1rem; }
#typora-sidebar #file-library-search .ty-search-item.active { background: rgb(33, 33, 33); }
#typora-sidebar .file-list-item-summary, #typora-sidebar .ty-search-item-line { font-family: "Avenir Next LT Pro", Lato, sans-serif; }
#typora-sidebar .ty-file-search-match-text, #typora-sidebar .ty-outline-hit { font-weight: bold; background: transparent; }
#typora-sidebar #outline-content { line-height: 1.4em; }
#typora-sidebar #outline-content .outline-h1 > .outline-item { font-family: Adelle, "Times New Roman", serif; }
#typora-sidebar .outline-title-wrapper, #typora-sidebar .outline-item-wrapper.outline-h1 > .outline-item { font-family: Adelle, "Times New Roman", serif; }
#typora-sidebar .file-library-node, #typora-sidebar .file-library-node .file-node-background { transition: background 0.4s ease 0s; }
#typora-sidebar .file-tree-node.file-library-file-node:not(.active):hover .file-node-background, #typora-sidebar .file-list-item.file-library-node:not(.active):hover { background: rgb(30, 32, 34); }
#typora-sidebar .file-tree-node.file-library-file-node.active .file-node-background, #typora-sidebar .file-list-item.file-library-file-node.active { border-left: 5px solid rgb(66, 139, 202); }
#typora-sidebar .blink-area { animation: 0s ease 0s 1 normal none running none; }
#typora-sidebar #ty-sidebar-footer { border-top: 1px solid rgb(25, 25, 28); }
#typora-sidebar #ty-sidebar-footer .sidebar-footer-item { transition: background 0.3s ease 0s; }
.dropdown-menu .active a, .dropdown-menu .has-extra-menu.active a, .dropdown-menu .has-btn-submenu .menu-style-btn.active, #footer-word-count-info .ty-footer-word-count-all tr:hover, #ty-spell-check-dict-missing-menu li:hover, .ty-spell-check-panel-item.ty-active, .ty-spell-check-panel-item:hover, .footer-item:hover { background: rgb(221, 221, 221) !important; color: rgb(43, 43, 43) !important; }
footer.ty-footer { border-top: 0px; }
#outline-btn:hover { color: inherit; }
.form-control:focus { border-color: rgb(66, 139, 202); box-shadow: rgba(0, 0, 0, 0.075) 0px 1px 1px inset, rgb(66, 139, 202) 0px 0px 2px; }
.megamenu-opened header { background-image: none; }
#top-titlebar, #top-titlebar * { color: inherit; }
#megamenu-content { padding-top: 28px; background: rgb(43, 43, 43); color: rgb(221, 221, 221); }
#megamenu-content .long-btn { border-color: rgba(146, 146, 146, 0.56); transition: border-color 0.4s ease 0s; }
#megamenu-content .long-btn:hover { border-color: rgb(66, 139, 202); background: rgb(30, 32, 34); color: rgb(255, 255, 255) !important; }
#megamenu-menu-panel:not(:first-of-type) { margin-top: 48px; }
#recent-file-panel-action-btn { background: inherit; border-color: rgba(146, 146, 146, 0.56); transition: all 0.4s ease 0s; }
#recent-file-panel-action-btn:hover { border-color: rgb(66, 139, 202); background: rgb(30, 32, 34); color: rgb(255, 255, 255); }
#recent-document-table { background-color: inherit; }
#recent-file-panel tbody tr:nth-child(2n-1) { background-color: inherit; }
#recent-file-panel tbody tr:hover { background-color: rgb(30, 32, 34) !important; }
#recent-file-panel tbody tr:hover td:nth-child(1) { color: rgb(255, 255, 255); }
#megamenu-menu-sidebar { background-color: rgb(30, 32, 34); color: rgb(221, 221, 221); }
.megamenu-menu-header, .megamenu-menu-list li:not(.saved) a { transition: all 0.4s ease 0s; }
.megamenu-menu-header { border-bottom: 1px solid rgb(22, 22, 26); }
.megamenu-menu-header:hover { background: rgb(22, 24, 25); }
.megamenu-menu-list li:not(.saved) a:not(.active):hover, .megamenu-menu-list li a.active { background: rgb(16, 16, 16) !important; }
#m-saved { background: inherit; color: inherit; }
#megamenu-menu-list { margin: 0px; }
.theme-preview-div { transition: all 0.4s ease 0s; }
.theme-preview-div:hover { border: 4px solid rgb(40, 94, 142); }
.theme-preview-div.active, .theme-preview-div.active:hover { border: 4px solid rgb(66, 139, 202); }
.theme-preview-div.active i { color: rgb(66, 139, 202); }
.cm-s-typora-default .cm-s-inner.CodeMirror-line { border: 0px !important; }
#write > p:first-child:empty { position: static; }
#write > p:first-child:not(:only-child)::before, #write > p:only-child::before { content: ""; display: block; position: absolute; top: 0px; left: 0px; right: 0px; bottom: 0px; background: url("ursine/night.png") 45% 90% / cover no-repeat transparent; opacity: 0; }
#write > p:only-child:empty::before { opacity: 1; }
@media print {
  #write ol > li, #write ul > li { color: rgb(221, 221, 221); }
}


</style>
</head>
<body class="typora-export os-windows">
<div id="write" class="is-node"><p>&nbsp;</p><h1><a name="keras入门笔记一-从二分类问题到多分类问题图像识别问题" class="md-header-anchor"></a><span>Keras入门笔记(一)-从二分类问题到多分类问题、图像识别问题</span></h1><blockquote><p><a href="https://keras.io/" target="_blank" rel="noopener"><span>Keras</span></a><span>是一个Python深度学习框架，是个高层的API库。它不同于TensorFlow、PyTorch等微分器，Keras高度封装了底层的微分计算等操作，提供了用户友好的API，并且支持在TensorFlow、Theano和CNTK这三个底层微分库之间切换。目前，Keras已被钦定为TensorFlow的用户接口，其地位相当于TorchVision之于PyTorch</span></p><ul><li><span>本文主要基于Keras</span><sup><span>2</span></sup><span>作介绍。</span></li></ul></blockquote><h2><a name="keras的结构" class="md-header-anchor"></a><span>Keras的结构</span></h2><p><span>Keras中我们</span></p><ul><li><code>utils</code></li><li><code>activations</code><span>：提供了常见的激活函数，如relu等。</span></li><li><code>applications</code><span>：</span></li><li><code>backend</code><span>：提供了TensorFlow、Theano和CNTK的底层接口。</span></li><li><code>datasets</code><span>：提供了一些常用的小数据集，用于上手。</span></li><li><code>engine</code></li><li><code>layers</code><span>：提供了常见的网络结构层，是Keras最重要的包。</span></li><li><code>preprocessing</code><span>：数据预处理模块，也提供了数据增强的常用包。</span></li><li><code>wrappers</code></li><li><code>callbacks</code></li><li><code>constraints</code></li><li><code>initializers</code><span>：提供了参数初始化的方法。</span></li><li><code>metrics</code></li><li><code>models</code><span>：模型是Keras对网络层、优化器等结构的组织模块。</span></li><li><code>losses</code><span>：提供了常见的损失函数/目标函数，如Mean-Squared-Error等。</span></li><li><code>optimizers</code><span>： 优化器，包含了一些优化的方法。</span></li><li><code>regularizers</code><span>：提供了一系列正则器。</span></li></ul><h2><a name="keras的常见结构" class="md-header-anchor"></a><span>Keras的常见结构</span></h2><p><strong><span>① 模型</span></strong></p><p><span>Keras的核心数据结构是“模型”，模型指的是对网络层的组织方式。目前，Keras的模型只有两种形式：</span></p><ol start><li><span>Sequential</span></li><li><span>Functional</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">models</span> <span class="cm-keyword">import</span> <span class="cm-variable">Sequential</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span> = <span class="cm-variable">Sequential</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 42px;"></div><div class="CodeMirror-gutters" style="display: none; height: 42px;"></div></div></div></pre><p><span>就构建了一个序列模型，接下下来就是不断往这个网络结构中添加不同的网络层并构建它们的连接次序。</span></p><p><strong><span>② 网络层</span></strong></p><p><span>网络层由</span><code>keras.layers</code><span>进行定义：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">layers</span> <span class="cm-keyword">import</span> <span class="cm-variable">Dense</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 21px;"></div><div class="CodeMirror-gutters" style="display: none; height: 21px;"></div></div></div></pre><p><span>就引入了一个全连接层，接着我们无返回地把它添加到网络结构中：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-variable">units</span>=<span class="cm-number">512</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">inputshap</span>=(<span class="cm-number">1024</span>, )))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-variable">units</span>=<span class="cm-number">10</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'softmax'</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 42px;"></div><div class="CodeMirror-gutters" style="display: none; height: 42px;"></div></div></div></pre><p><span>就为网路结构添加了一个512个神经元的全链接层和10个神经元的输出层。</span></p><blockquote><p><span>注意到：只有第一层需要指定输入数据的尺寸；此后的每一层将会自动进行推导。</span></p></blockquote><p><strong><span>③ 模型编译</span></strong><span>和训练</span></p><p><span>现在我们要指定模型的训练方式，我们需要重点关心的有：</span></p><ol start><li><code>optimizer</code><span>：优化器，可能会影响到模型的收敛速度</span></li><li><code>loss</code><span>：模型的目标函数/损失函数</span></li><li><code>metrics</code><span>：指标列表，训练时将会根据该列表记录训练效果的衡量值</span></li><li><code>epochs</code><span>、</span><code>batch_size</code><span>：训练的轮次和梯度下降时每个batch将包含的样本数。</span></li><li><code>verbose</code><span>：控制台日志，值为</span><code>0|1|2</code><span>——分别对应”不在控制台输出任何消息“、“训练每轮训练进度”、“仅输出训练轮的信息”</span></li><li><code>validation_data</code><span>、</span><code>validation_split</code><span>：验证集或自动划分验证集的比例。</span></li></ol><p><span>我们调用</span><code>model.compile</code><span>方法进行编译：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="pyt"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="pyt"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">network.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 21px;"></div><div class="CodeMirror-gutters" style="display: none; height: 21px;"></div></div></div></pre><p><span>随后，再对编译完毕的模型进行训练：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="py"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="py"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">network.fit(train_data, train_labels, epochs=10, batch_size=1024, validation_split=0.3, verbose=2)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 21px;"></div><div class="CodeMirror-gutters" style="display: none; height: 21px;"></div></div></div></pre><h2><a name="二分类问题电影评论分类" class="md-header-anchor"></a><span>二分类问题：电影评论分类</span></h2><p><span>二分类问题可能是应用最广泛的机器学习问题。我们可以利用Keras自带的IMDB数据集进行初步上手练习。</span></p><p><span>IMDB 数据集它包含来自互联网电影数据库（IMDB）的 50 000 条严重两极分化的评论。数据集被分为用于训练的 25 000 条评论与用于测试的 25 000 条评论，训练集和测试集都包含 50% 的正面评论和 50% 的负面评论。</span></p><blockquote><ul><li><code>imdb_data</code><span> 是由评论词组成的索引列表，其前三位为保留值，即真正的评论词索引从序数 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.161ex" height="2.107ex" viewbox="0 -784.8 500 907.3" role="img" focusable="false" style="vertical-align: -0.284ex;"><defs><path stroke-width="0" id="E2-MJMAIN-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E2-MJMAIN-33" x="0" y="0"/></g></svg></span><script type="math/tex">3</script><span> 开始。</span></li><li><code>imdb_label</code><span> 是由 </span><code>0|1</code><span> 组成的二值化评价。</span></li></ul></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">imdb</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">layers</span> <span class="cm-keyword">import</span> <span class="cm-variable">Dense</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">models</span> <span class="cm-keyword">import</span> <span class="cm-variable">Sequential</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pyplot</span> <span class="cm-keyword">as</span> <span class="cm-variable">plt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">ont_hot</span>(<span class="cm-variable">data_mat</span>, <span class="cm-variable">dim</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  对一个矩阵进行独热编码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :param data_mat: 数据矩阵</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :param dim: 独热编码的维度</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :return: 返回独热编码后的数据矩阵</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">res</span> = <span class="cm-variable">np</span>.<span class="cm-property">zeros</span>((<span class="cm-builtin">len</span>(<span class="cm-variable">data_mat</span>), <span class="cm-variable">dim</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">i</span>, <span class="cm-variable">index</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">data_mat</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">res</span>[<span class="cm-variable">i</span>][<span class="cm-variable">index</span>] = <span class="cm-number">1.0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">res</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 取前10000个高频评论词汇</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nb_words</span> = <span class="cm-number">10000</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-variable">train_data</span>, <span class="cm-variable">train_labels</span>), (<span class="cm-variable">test_data</span>, <span class="cm-variable">test_labels</span>) = <span class="cm-variable">imdb</span>.<span class="cm-property">load_data</span>(<span class="cm-variable">num_words</span>=<span class="cm-variable">nb_words</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 对训练数据、测试数据进行独热编码和numpy向量化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">train_data</span> = <span class="cm-variable">ont_hot</span>(<span class="cm-variable">train_data</span>, <span class="cm-variable">nb_words</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">test_data</span> = <span class="cm-variable">ont_hot</span>(<span class="cm-variable">test_data</span>, <span class="cm-variable">nb_words</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">train_labels</span> = <span class="cm-variable">np</span>.<span class="cm-property">asarray</span>(<span class="cm-variable">train_labels</span>).<span class="cm-property">astype</span>(<span class="cm-string">'float32'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">test_labels</span> = <span class="cm-variable">np</span>.<span class="cm-property">asarray</span>(<span class="cm-variable">test_labels</span>).<span class="cm-property">astype</span>(<span class="cm-string">'float32'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span> = <span class="cm-variable">Sequential</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">16</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">input_shape</span>=(<span class="cm-variable">nb_words</span>,)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">16</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">input_shape</span>=(<span class="cm-number">16</span>,)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">1</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'sigmoid'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">compile</span>(<span class="cm-variable">optimizer</span>=<span class="cm-string">'adam'</span>, <span class="cm-variable">loss</span>=<span class="cm-string">'binary_crossentropy'</span>, <span class="cm-variable">metrics</span>=[<span class="cm-string">'accuracy'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">history</span> = <span class="cm-variable">network</span>.<span class="cm-property">fit</span>(<span class="cm-variable">train_data</span>, <span class="cm-variable">train_labels</span>, <span class="cm-variable">epochs</span>=<span class="cm-number">10</span>, <span class="cm-variable">batch_size</span>=<span class="cm-number">1024</span>, <span class="cm-variable">validation_split</span>=<span class="cm-number">0.3</span>, <span class="cm-variable">verbose</span>=<span class="cm-number">2</span>).<span class="cm-property">history</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># --模型的应用--</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 随机选择一项进行预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">result</span> = <span class="cm-builtin">list</span>(<span class="cm-builtin">map</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">x</span>: <span class="cm-number">1</span> <span class="cm-keyword">if</span> <span class="cm-variable">x</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0.5</span> <span class="cm-keyword">else</span> <span class="cm-number">0</span>, <span class="cm-variable">network</span>.<span class="cm-property">predict</span>(<span class="cm-variable">test_data</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">'positive'</span> <span class="cm-keyword">if</span> <span class="cm-variable">result</span>[<span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">randint</span>(<span class="cm-builtin">len</span>(<span class="cm-variable">result</span>))] == <span class="cm-number">1</span> <span class="cm-keyword">else</span> <span class="cm-string">'negative'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 画图，可以明显看到过拟合现象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">train_loss</span>, <span class="cm-variable">val_loss</span> = <span class="cm-variable">history</span>[<span class="cm-string">'loss'</span>], <span class="cm-variable">history</span>[<span class="cm-string">'val_loss'</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">epochs</span> = <span class="cm-builtin">range</span>(<span class="cm-builtin">len</span>(<span class="cm-variable">train_loss</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">plot</span>(<span class="cm-variable">epochs</span>, <span class="cm-variable">train_loss</span>, <span class="cm-string">'bo'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'train loss'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">plot</span>(<span class="cm-variable">epochs</span>, <span class="cm-variable">val_loss</span>, <span class="cm-string">'b-'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'val loss'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">'epochs'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">'loss'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">legend</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1239px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1239px;"></div></div></div></pre><h2><a name="多分类问题路透社新闻评论" class="md-header-anchor"></a><span>多分类问题：路透社新闻评论</span></h2><p><span>透社数据集，它包含许多短新闻及其对应的主题，由路透社在 1986 年发布。它是一个简单的、广泛使用的文本分类数据集。</span></p><p><span>路透社新闻数据集和IMDB数据集类似，只不过其label为 </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.323ex" height="2.147ex" viewbox="0 -790.8 1000 924.3" role="img" focusable="false" style="vertical-align: -0.31ex;"><defs><path stroke-width="0" id="E7-MJMAIN-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"/><path stroke-width="0" id="E7-MJMAIN-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E7-MJMAIN-34"/><use xlink:href="#E7-MJMAIN-36" x="500" y="0"/></g></svg></span><script type="math/tex">46</script><span> 维的输出值。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">reuters</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">utils</span> <span class="cm-keyword">import</span> <span class="cm-variable">to_categorical</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">models</span> <span class="cm-keyword">import</span> <span class="cm-variable">Sequential</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">layers</span> <span class="cm-keyword">import</span> <span class="cm-variable">Dense</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pyplot</span> <span class="cm-keyword">as</span> <span class="cm-variable">plt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nb_words</span> = <span class="cm-number">10000</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-variable">train_data</span>, <span class="cm-variable">train_labels</span>), (<span class="cm-variable">test_data</span>, <span class="cm-variable">test_labels</span>) = <span class="cm-variable">reuters</span>.<span class="cm-property">load_data</span>(<span class="cm-variable">num_words</span>=<span class="cm-variable">nb_words</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">ont_hot</span>(<span class="cm-variable">data_mat</span>, <span class="cm-variable">dim</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  对一个矩阵进行独热编码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :param data_mat: 数据矩阵</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :param dim: 独热编码的维度</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :return: 返回独热编码后的数据矩阵</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">res</span> = <span class="cm-variable">np</span>.<span class="cm-property">zeros</span>((<span class="cm-builtin">len</span>(<span class="cm-variable">data_mat</span>), <span class="cm-variable">dim</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">i</span>, <span class="cm-variable">index</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">data_mat</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">res</span>[<span class="cm-variable">i</span>][<span class="cm-variable">index</span>] = <span class="cm-number">1.0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">res</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">train_data</span> = <span class="cm-variable">ont_hot</span>(<span class="cm-variable">train_data</span>, <span class="cm-variable">nb_words</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">test_data</span> = <span class="cm-variable">ont_hot</span>(<span class="cm-variable">test_data</span>, <span class="cm-variable">nb_words</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 采用 loss='categorical_crossentropy'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># train_labels = to_categorical(train_labels)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># test_labels = to_categorical(test_labels)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 采用 loss='sparse_categorical_crossentropy' 只需要编译成一个numpy张量即可</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># train_labels = np.array(train_labels)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># test_labels = np.array(test_labels)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span> = <span class="cm-variable">Sequential</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">128</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">input_shape</span>=(<span class="cm-variable">nb_words</span>,)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">64</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">46</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'softmax'</span>)) &nbsp;<span class="cm-comment"># 与imdb数据集不同，其输出不是二分类问题</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">compile</span>(<span class="cm-variable">optimizer</span>=<span class="cm-string">'adam'</span>, <span class="cm-variable">loss</span>=<span class="cm-string">'sparse_categorical_crossentropy'</span>, <span class="cm-variable">metrics</span>=[<span class="cm-string">'accuracy'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">history</span> = <span class="cm-variable">network</span>.<span class="cm-property">fit</span>(<span class="cm-variable">train_data</span>, <span class="cm-variable">train_labels</span>, <span class="cm-variable">epochs</span>=<span class="cm-number">20</span>, <span class="cm-variable">batch_size</span>=<span class="cm-number">1024</span>, <span class="cm-variable">validation_split</span>=<span class="cm-number">0.3</span>, <span class="cm-variable">verbose</span>=<span class="cm-number">2</span>).<span class="cm-property">history</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># --模型的应用--</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 画图，可以明显看到过拟合现象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">train_loss</span>, <span class="cm-variable">val_loss</span> = <span class="cm-variable">history</span>[<span class="cm-string">'loss'</span>], <span class="cm-variable">history</span>[<span class="cm-string">'val_loss'</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">epochs</span> = <span class="cm-builtin">range</span>(<span class="cm-builtin">len</span>(<span class="cm-variable">train_loss</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">plot</span>(<span class="cm-variable">epochs</span>, <span class="cm-variable">train_loss</span>, <span class="cm-string">'bo'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'train loss'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">plot</span>(<span class="cm-variable">epochs</span>, <span class="cm-variable">val_loss</span>, <span class="cm-string">'b-'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'val loss'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">'epochs'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">'loss'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">legend</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1281px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1281px;"></div></div></div></pre><h2><a name="回归问题波士顿房价" class="md-header-anchor"></a><span>回归问题：波士顿房价</span></h2><p><span>任何看过西瓜书或吴恩达视频课程的同学都不会对这个数据集感到陌生。</span></p><p><span>不同于上两个问题的做法，我们将在下文采用新的损失函数和评价指标。</span></p><p><span>首先我们将采用K折法对模型进行评价，所以我们需要多次编译模型，因此需要构建一个模块化的模型方法：</span><code>nn()</code><span>。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">boston_housing</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">models</span> <span class="cm-keyword">import</span> <span class="cm-variable">Sequential</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">layers</span> <span class="cm-keyword">import</span> <span class="cm-variable">Dense</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pyplot</span> <span class="cm-keyword">as</span> <span class="cm-variable">plt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">z_score</span>(<span class="cm-variable">data</span>, <span class="cm-variable">axis</span>=<span class="cm-number">0</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :param data: 2-D numpy - array</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :param axis: ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :return:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">mean</span> = <span class="cm-variable">data</span>.<span class="cm-property">mean</span>(<span class="cm-variable">axis</span>=<span class="cm-variable">axis</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std</span> = <span class="cm-variable">data</span>.<span class="cm-property">std</span>(<span class="cm-variable">axis</span>=<span class="cm-variable">axis</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">data</span> <span class="cm-operator">-</span> <span class="cm-variable">mean</span>) <span class="cm-operator">/</span> <span class="cm-variable">std</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">nn</span>(<span class="cm-variable">data_shape</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :param data_shape: (size of samples, num of features)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  :return:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_model</span> = <span class="cm-variable">Sequential</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">64</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">input_shape</span>=(<span class="cm-variable">data_shape</span>[<span class="cm-number">1</span>],)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">32</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># MSE 均方误差</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># MAE 平均绝对误差 : 预测值与目标值之差的绝对值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_model</span>.<span class="cm-property">compile</span>(<span class="cm-variable">optimizer</span>=<span class="cm-string">'sgd'</span>, <span class="cm-variable">loss</span>=<span class="cm-string">'mse'</span>, <span class="cm-variable">metrics</span>=[<span class="cm-string">'mae'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">k_model</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-variable">train_data</span>, <span class="cm-variable">train_targets</span>), (<span class="cm-variable">test_data</span>, <span class="cm-variable">test_targets</span>) = <span class="cm-variable">boston_housing</span>.<span class="cm-property">load_data</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 标准化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">train_data</span> = <span class="cm-variable">z_score</span>(<span class="cm-variable">train_data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">test_data</span> = <span class="cm-variable">z_score</span>(<span class="cm-variable">test_data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># K折法训练</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">k</span> = <span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">histories</span> = []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">k</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">network</span> = <span class="cm-variable">nn</span>(<span class="cm-variable">train_data</span>.<span class="cm-property">shape</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_nums_samples</span> = <span class="cm-variable">train_data</span>.<span class="cm-property">shape</span>[<span class="cm-number">0</span>] <span class="cm-operator">//</span> <span class="cm-variable">k</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_val_data</span> = <span class="cm-variable">train_data</span>[<span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">k_nums_samples</span>:(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-variable">k_nums_samples</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_val_targets</span> = <span class="cm-variable">train_targets</span>[<span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">k_nums_samples</span>:(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-variable">k_nums_samples</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_train_data</span> = <span class="cm-error">\</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">np</span>.<span class="cm-property">concatenate</span>([<span class="cm-variable">train_data</span>[: <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">k_nums_samples</span>], <span class="cm-variable">train_data</span>[(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-variable">k_nums_samples</span>:]], <span class="cm-variable">axis</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_train_targets</span> = <span class="cm-error">\</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">np</span>.<span class="cm-property">concatenate</span>([<span class="cm-variable">train_targets</span>[: <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">k_nums_samples</span>], <span class="cm-variable">train_targets</span>[(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-variable">k_nums_samples</span>:]], <span class="cm-variable">axis</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">history</span> = <span class="cm-variable">network</span>.<span class="cm-property">fit</span>(<span class="cm-variable">k_val_data</span>, <span class="cm-variable">k_val_targets</span>, <span class="cm-variable">epochs</span>=<span class="cm-number">200</span>, <span class="cm-variable">batch_size</span>=<span class="cm-number">256</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">validation_data</span>=(<span class="cm-variable">k_val_data</span>, <span class="cm-variable">k_val_targets</span>), <span class="cm-variable">verbose</span>=<span class="cm-number">2</span>).<span class="cm-property">history</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">histories</span>.<span class="cm-property">append</span>(<span class="cm-variable">history</span>[<span class="cm-string">'val_loss'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># --模型的应用--</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 画图，可以明显看到过拟合现象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">epochs</span> = <span class="cm-builtin">len</span>(<span class="cm-variable">histories</span>[<span class="cm-number">0</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">avg_val_loss</span> = [<span class="cm-variable">np</span>.<span class="cm-property">mean</span>([<span class="cm-variable">k</span>[<span class="cm-variable">i</span>] <span class="cm-keyword">for</span> <span class="cm-variable">k</span> <span class="cm-keyword">in</span> <span class="cm-variable">histories</span>]) <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">epochs</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">plot</span>(<span class="cm-builtin">range</span>(<span class="cm-variable">epochs</span>), <span class="cm-variable">avg_val_loss</span>, <span class="cm-string">'r-.'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'val loss'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">'epochs'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">'loss'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">legend</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1596px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1596px;"></div></div></div></pre><p align="center">
    <img src="./sgd.jpg" alt="sgd.jpg">
</p><p>&nbsp;</p><p><span>如果把上文中的优化器换成</span><code>adam</code><span>（滑动平均），会观察到一个更平缓的函数图像：</span></p><p align="center">
    <img src="./adam.jpg" alt="adam.jpg">
</p><h2><a name="图像识别问题mnist数据集" class="md-header-anchor"></a><span>图像识别问题：MNIST数据集</span></h2><p><span>MINIST数据集非常经典，不需要进行更多地介绍，采用全连接对MNIST进行训练也很简单：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">keras</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">mnist</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">layers</span> <span class="cm-keyword">import</span> <span class="cm-variable">Dense</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">models</span> <span class="cm-keyword">import</span> <span class="cm-variable">Sequential</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 载入数据集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-variable">train_images</span>, <span class="cm-variable">train_labels</span>), (<span class="cm-variable">test_images</span>, <span class="cm-variable">test_labels</span>) = <span class="cm-variable">mnist</span>.<span class="cm-property">load_data</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x_train</span>, <span class="cm-variable">h</span>, <span class="cm-variable">w</span> = <span class="cm-variable">train_images</span>.<span class="cm-property">shape</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">train_images</span> = <span class="cm-variable">train_images</span>.<span class="cm-property">reshape</span>((<span class="cm-variable">x_train</span>, <span class="cm-variable">h</span> <span class="cm-operator">*</span> <span class="cm-variable">w</span>)) <span class="cm-operator">/</span> <span class="cm-number">255</span> &nbsp;<span class="cm-comment"># 归一化处理，可以使得其更快收敛</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x_test</span>, <span class="cm-variable">h</span>, <span class="cm-variable">w</span> = <span class="cm-variable">test_images</span>.<span class="cm-property">shape</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">test_images</span> = <span class="cm-variable">test_images</span>.<span class="cm-property">reshape</span>((<span class="cm-variable">x_test</span>, <span class="cm-variable">h</span> <span class="cm-operator">*</span> <span class="cm-variable">w</span>)) <span class="cm-operator">/</span> <span class="cm-number">255</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 对一个list进行one-hot编码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">train_labels</span> = <span class="cm-variable">keras</span>.<span class="cm-property">utils</span>.<span class="cm-property">to_categorical</span>(<span class="cm-variable">train_labels</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">test_labels</span> = <span class="cm-variable">keras</span>.<span class="cm-property">utils</span>.<span class="cm-property">to_categorical</span>(<span class="cm-variable">test_labels</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 构建网络模型</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span> = <span class="cm-variable">Sequential</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">512</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">input_shape</span>=(<span class="cm-variable">h</span> <span class="cm-operator">*</span> <span class="cm-variable">w</span>,)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">128</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">input_shape</span>=(<span class="cm-number">512</span>,)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">10</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'softmax'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">compile</span>(<span class="cm-variable">optimizer</span>=<span class="cm-string">'adam'</span>, <span class="cm-variable">loss</span>=<span class="cm-string">'categorical_crossentropy'</span>, <span class="cm-variable">metrics</span>=[<span class="cm-string">'accuracy'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">fit</span>(<span class="cm-variable">train_images</span>, <span class="cm-variable">train_labels</span>, <span class="cm-variable">epochs</span>=<span class="cm-number">10</span>, <span class="cm-variable">batch_size</span>=<span class="cm-number">1024</span>, <span class="cm-variable">verbose</span>=<span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">network</span>.<span class="cm-property">summary</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">'loss, acc='</span>, <span class="cm-variable">network</span>.<span class="cm-property">evaluate</span>(<span class="cm-variable">test_images</span>, <span class="cm-variable">test_labels</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># --模型的应用--</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pyplot</span> <span class="cm-keyword">as</span> <span class="cm-variable">plt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">index</span> = <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">randint</span>(<span class="cm-number">0</span>, <span class="cm-variable">x_test</span>) &nbsp;<span class="cm-comment"># random pick a test-image</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">test_images</span>.<span class="cm-property">reshape</span>(<span class="cm-variable">x_test</span>, <span class="cm-variable">h</span>, <span class="cm-variable">w</span>)[<span class="cm-variable">index</span>], <span class="cm-variable">cmap</span>=<span class="cm-variable">plt</span>.<span class="cm-property">cm</span>.<span class="cm-property">binary</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">show</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span> = <span class="cm-variable">network</span>.<span class="cm-property">predict</span>(<span class="cm-variable">test_images</span>)[<span class="cm-variable">index</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 输出的是softmax()的值，其中最大值对应的索引即为预测的数字</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">'The digit is %d'</span> <span class="cm-operator">%</span> <span class="cm-variable">np</span>.<span class="cm-property">where</span>(<span class="cm-variable">res</span> == <span class="cm-variable">np</span>.<span class="cm-property">max</span>(<span class="cm-variable">res</span>))[<span class="cm-number">0</span>][<span class="cm-number">0</span>])</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 966px;"></div><div class="CodeMirror-gutters" style="display: none; height: 966px;"></div></div></div></pre><p><span>不同的是，我们可以引入CNN来对图像进行处理，例如VGG-16模型：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span> <span class="cm-keyword">import</span> <span class="cm-variable">models</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span> <span class="cm-keyword">import</span> <span class="cm-variable">Sequential</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">layers</span> <span class="cm-keyword">import</span> <span class="cm-variable">Dense</span>, <span class="cm-variable">Activation</span>, <span class="cm-variable">Conv2D</span>, <span class="cm-variable">MaxPooling2D</span>, <span class="cm-variable">Flatten</span>, <span class="cm-variable">Dropout</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">layers</span> <span class="cm-keyword">import</span> <span class="cm-variable">Input</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">optimizers</span> <span class="cm-keyword">import</span> <span class="cm-variable">SGD</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">cv2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">json</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">mnist</span> &nbsp;<span class="cm-comment"># 从keras中导入mnist数据集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">keras</span> <span class="cm-keyword">import</span> <span class="cm-variable">utils</span> &nbsp;<span class="cm-comment"># 从keras中导入mnist数据集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resize_to</span> = <span class="cm-number">64</span> &nbsp;<span class="cm-comment"># 重塑尺寸</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-variable">x_train</span>, <span class="cm-variable">y_train</span>), (<span class="cm-variable">x_test</span>, <span class="cm-variable">y_test</span>) = <span class="cm-variable">mnist</span>.<span class="cm-property">load_data</span>() &nbsp;<span class="cm-comment"># 下载mnist数据集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x_train</span> = [<span class="cm-variable">cv2</span>.<span class="cm-property">cvtColor</span>(<span class="cm-variable">cv2</span>.<span class="cm-property">resize</span>(<span class="cm-variable">i</span>, (<span class="cm-variable">resize_to</span>, <span class="cm-variable">resize_to</span>)), <span class="cm-variable">cv2</span>.<span class="cm-property">COLOR_GRAY2RGB</span>) <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">x_train</span>] &nbsp;<span class="cm-comment"># 变成彩色的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x_test</span> = [<span class="cm-variable">cv2</span>.<span class="cm-property">cvtColor</span>(<span class="cm-variable">cv2</span>.<span class="cm-property">resize</span>(<span class="cm-variable">i</span>, (<span class="cm-variable">resize_to</span>, <span class="cm-variable">resize_to</span>)), <span class="cm-variable">cv2</span>.<span class="cm-property">COLOR_GRAY2RGB</span>) <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">x_test</span>] &nbsp;<span class="cm-comment"># 变成彩色的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x_train</span> = <span class="cm-variable">np</span>.<span class="cm-property">array</span>(<span class="cm-variable">x_train</span>).<span class="cm-property">reshape</span>(<span class="cm-number">60000</span>, <span class="cm-variable">resize_to</span>, <span class="cm-variable">resize_to</span>, <span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x_test</span> = <span class="cm-variable">np</span>.<span class="cm-property">array</span>(<span class="cm-variable">x_test</span>).<span class="cm-property">reshape</span>(<span class="cm-number">10000</span>, <span class="cm-variable">resize_to</span>, <span class="cm-variable">resize_to</span>, <span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">utils</span>.<span class="cm-property">to_categorical</span>(<span class="cm-variable">y_train</span>, <span class="cm-number">10</span>), <span class="cm-variable">utils</span>.<span class="cm-property">to_categorical</span>(<span class="cm-variable">y_test</span>, <span class="cm-number">10</span>) &nbsp;<span class="cm-comment"># 独热编码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x_train</span>, <span class="cm-variable">x_test</span> = <span class="cm-variable">x_train</span> <span class="cm-operator">/</span> <span class="cm-number">255</span>, <span class="cm-variable">x_test</span> <span class="cm-operator">/</span> <span class="cm-number">255</span> &nbsp;<span class="cm-comment"># 归一化处理</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span> = <span class="cm-variable">Sequential</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># BLOCK 1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">64</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block1_conv1'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">input_shape</span>=(<span class="cm-variable">resize_to</span>, <span class="cm-variable">resize_to</span>, <span class="cm-number">3</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">64</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block1_conv2'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">MaxPooling2D</span>(<span class="cm-variable">pool_size</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">strides</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">name</span>=<span class="cm-string">'block1_pool'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># BLOCK2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">128</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block2_conv1'</span>))</span></pre><div class style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">128</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block2_conv2'</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">MaxPooling2D</span>(<span class="cm-variable">pool_size</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">strides</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">name</span>=<span class="cm-string">'block2_pool'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># BLOCK3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">256</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block3_conv1'</span>))</span></pre><div class style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">256</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block3_conv2'</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">256</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block3_conv3'</span>))</span></pre><div class style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">MaxPooling2D</span>(<span class="cm-variable">pool_size</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">strides</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">name</span>=<span class="cm-string">'block3_pool'</span>))</span></pre></div><div class style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># BLOCK4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">512</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block4_conv1'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">512</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block4_conv2'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">512</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block4_conv3'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">MaxPooling2D</span>(<span class="cm-variable">pool_size</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">strides</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">name</span>=<span class="cm-string">'block4_pool'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># BLOCK5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">512</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block5_conv1'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">512</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block5_conv2'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Conv2D</span>(<span class="cm-variable">filters</span>=<span class="cm-number">512</span>, <span class="cm-variable">kernel_size</span>=(<span class="cm-number">3</span>, <span class="cm-number">3</span>), <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">padding</span>=<span class="cm-string">'same'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'block5_conv3'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">MaxPooling2D</span>(<span class="cm-variable">pool_size</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">strides</span>=(<span class="cm-number">2</span>, <span class="cm-number">2</span>), <span class="cm-variable">name</span>=<span class="cm-string">'block5_pool'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Flatten</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">4096</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'fc1'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># model.add(Dropout(0.5))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">4096</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'fc2'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># model.add(Dropout(0.5))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">1000</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'relu'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'fc3'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># model.add(Dropout(0.5))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">add</span>(<span class="cm-variable">Dense</span>(<span class="cm-number">10</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'softmax'</span>, <span class="cm-variable">name</span>=<span class="cm-string">'prediction'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">compile</span>(<span class="cm-variable">optimizer</span>=<span class="cm-variable">SGD</span>(<span class="cm-variable">lr</span>=<span class="cm-number">0.05</span>, <span class="cm-variable">decay</span>=<span class="cm-number">1e-5</span>), <span class="cm-variable">loss</span>=<span class="cm-string">'categorical_crossentropy'</span>, <span class="cm-variable">metrics</span>=[<span class="cm-string">'accuracy'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">summary</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">fit</span>(<span class="cm-variable">x_train</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">batch_size</span>=<span class="cm-number">64</span>, <span class="cm-variable">epochs</span>=<span class="cm-number">5</span>, <span class="cm-variable">validation_split</span>=<span class="cm-number">0.16666</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">score</span> = <span class="cm-variable">model</span>.<span class="cm-property">evaluate</span>(<span class="cm-variable">x_test</span>, <span class="cm-variable">y_test</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"loss:"</span>, <span class="cm-variable">score</span>[<span class="cm-number">0</span>], <span class="cm-string">"acc:"</span>, <span class="cm-variable">score</span>[<span class="cm-number">1</span>])</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1470px;"></div></div></div></pre><p><span>在训练完毕后我们还可以直接保存这个模型，调用的函数是：</span></p><ol><li><code>model.to_json()</code><span>：把模型的结构写出为一个json文件</span></li><li><code>model.save_weights()</code><span>：把模型的参数(权重)保存为一个h5文件</span></li><li><code>model.load_from_json()</code><span>、</span><code>model.set_weights()</code><span>：载入网络结构和网络的参数(权重)</span></li></ol><p><span>例如，对上文中VGG-16的模型可以采用以下脚本保存脚本：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 7px; left: 6.79688px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># save model</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-string">"./model/model_config.json"</span>, <span class="cm-string">"w"</span>) <span class="cm-keyword">as</span> <span class="cm-variable">file</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-property">write</span>(<span class="cm-variable">model</span>.<span class="cm-property">to_json</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span>.<span class="cm-property">save_weights</span>(<span class="cm-string">"./model/model_weights.h5"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># model.save("./model/model_config_and_weights.h5")  # 同时保存模型和训练参数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text>​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 载入方式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># model = keras.models.load_model('model_config_and_weights.h5') # 同时载入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># with open("./model/model_config.json", "r") as file:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; json_string = json.load(file)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># model = models.model_from_json(json_string)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># model_weights = models.load_model('model_weights.h5')</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># model.set_weights(model_weights)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 315px;"></div><div class="CodeMirror-gutters" style="display: none; height: 315px;"></div></div></div></pre><p>&nbsp;</p></div>
</body>
</html>
            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='https://gitee.com/shenpibaipao/wr-diaspora/raw/master/source/audio/jinyecheng.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='https://gitee.com/shenpibaipao/wr-diaspora/raw/master/source/audio/juhuatai.mp3'></li>
                        
                    
                        
                            <li title='2' data-url='https://gitee.com/shenpibaipao/wr-diaspora/raw/master/source/audio/MapleStory.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='5b763306cd7b9d9c3981'
        data-cs='c31e9bf78a807055f5439caea747b09d1d9c8f18'
        data-r='image-blog.io'
        data-o='WhiteRobe'
        data-a='WhiteRobe'
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#write"><span class="toc-number">1.</span> <span class="toc-text">Keras入门笔记(一)-从二分类问题到多分类问题、图像识别问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#write"><span class="toc-number">1.1.</span> <span class="toc-text">Keras的结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#write"><span class="toc-number">1.2.</span> <span class="toc-text">Keras的常见结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#write"><span class="toc-number">1.3.</span> <span class="toc-text">二分类问题：电影评论分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#write"><span class="toc-number">1.4.</span> <span class="toc-text">多分类问题：路透社新闻评论</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#write"><span class="toc-number">1.5.</span> <span class="toc-text">回归问题：波士顿房价</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#write"><span class="toc-number">1.6.</span> <span class="toc-text">图像识别问题：MNIST数据集</span></a></li></ol></li></ol>
        </div>
    
</div>


    </div>
    <!--下悬浮返回键-->
    <div style="background: white; height:30px; width: 30px; border-radius: 16px; position: fixed; bottom: 1.5rem; right: 1.5rem; border: 2px solid rgba(0, 0, 0, 0.5)">
      <a class="icon-left image-icon" style="left:4px; top:4px" href="javascript:history.back()"></a>
    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
